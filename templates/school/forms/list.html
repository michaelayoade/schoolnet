{% extends "school/base.html" %}
{% block title %}Admission Forms - School Admin{% endblock %}
{% block school_content %}
<div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-slate-900 dark:text-white font-display">Admission Forms</h1>
    {% if school %}
    <a href="/school/forms/create" class="rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 transition">Create Form</a>
    {% endif %}
</div>

{% if forms %}
<div class="space-y-4">
    {% for item in forms %}
    {% set form = item.form %}
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-5">
        <div class="flex items-start justify-between">
            <div>
                <h3 class="font-semibold text-slate-900 dark:text-white">{{ form.title }}</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">{{ form.academic_year }} &bull; {{ form.current_submissions }} submission{{ 's' if form.current_submissions != 1 else '' }}</p>
                {% if item.price_amount %}
                <p class="text-sm text-primary-600 dark:text-primary-400 font-medium mt-1">&#8358;{{ "{:,.0f}".format(item.price_amount / 100) }}</p>
                {% endif %}
            </div>
            <div class="flex items-center gap-2">
                {% set status_colors = {'draft': 'bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300', 'active': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400', 'closed': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400', 'archived': 'bg-slate-100 text-slate-500'} %}
                <span class="inline-flex px-2 py-0.5 rounded-full text-xs font-medium {{ status_colors.get(form.status.value, 'bg-slate-100 text-slate-700') }}">
                    {{ form.status.value | title }}
                </span>
                <a href="/school/forms/{{ form.id }}/edit" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">Edit</a>
                {% if form.status.value == 'draft' %}
                <form method="POST" action="/school/forms/{{ form.id }}/activate" class="inline">
                    {{ request.state.csrf_form | safe }}
                    <button type="submit" class="text-sm text-green-600 dark:text-green-400 hover:underline">Activate</button>
                </form>
                {% elif form.status.value == 'active' %}
                <form method="POST" action="/school/forms/{{ form.id }}/close" class="inline">
                    {{ request.state.csrf_form | safe }}
                    <button type="submit" class="text-sm text-red-600 dark:text-red-400 hover:underline">Close</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-12 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
    <p class="text-slate-500 dark:text-slate-400">No admission forms yet.</p>
    {% if school %}
    <a href="/school/forms/create" class="mt-4 inline-block text-primary-600 dark:text-primary-400 font-medium hover:underline">Create your first form</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
